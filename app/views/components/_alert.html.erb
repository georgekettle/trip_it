<% if notice %>
  <p class="alert alert-success"><%= notice %></p>
<% end %>
<% if alert %>
  <p class="alert alert-danger"><%= alert %></p>
<% end %>

<%
  flash_name_mappings = {
    "notice" => "success",
    "error" => "danger",
    "alert" => "warning"
  }
%>

<% flash.each do |name, msg| %>
  <% if msg.is_a?(String) %>
    <% flash_token = Time.current.to_s(:number) # or use any other random token generator, like Devise.friendly_token %>

    <div id="flash-<%= flash_token %>" style="display:none" class="alert alert-<%= flash_name_mappings[name] || name  %>">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      <%= content_tag :div, msg.html_safe, id: "flash_#{name}" %>
    </div>

    <script type="text/javascript">
      $(document).ready(function(){
        if (typeof(Storage) !== "undefined") {
          // Code for localStorage/sessionStorage.
          if(sessionStorage["flash-<%= flash_token %>"] != "shown"){
            $("#flash-<%= flash_token %>").show();
            sessionStorage["flash-<%= flash_token %>"] = "shown";
          }
        } else {
          // Sorry! No Web Storage support..
          $("#flash-<%= flash_token %>").show();
        }
      }
    </script>
  <% end %>
<% end %>
